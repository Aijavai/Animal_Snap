import{f as j,r as h,c as R,d as G,l as K,o as W,q as n,s as o,t as v,e as X,C as Y,F as p,E as m,G as Z,D as M,y as q,I as ee,H as te,z as a}from"./vue-vendor-DjNuForC.js";import{u as se}from"./animal-CiS26lDf.js";import{p as k,d as oe,t as re}from"./performance-DTgyZ5pq.js";import{S as ae,A as ne}from"./AnimalCard-BJ4JH0fU.js";import{_ as ie}from"./index-B5beYMX8.js";import"./vant-vendor-D-yQvc_G.js";const le={class:"search-page"},ce={class:"search-header"},ue={class:"search-input-wrapper"},de={key:0,class:"search-suggestions"},he={key:0,class:"suggestions-section"},ve={class:"hot-searches"},fe=["onClick"],ge={key:1,class:"suggestions-section"},pe={class:"history-list"},me=["onClick"],ke=["onClick"],ye={key:2,class:"suggestions-section"},we={class:"suggestions-list"},Se=["onClick"],Ce=["innerHTML"],_e={key:1,class:"search-results"},be={class:"section-header"},xe={class:"result-count"},Be={key:0,class:"animals-grid"},Re={key:1,class:"empty-search"},Me={key:2,class:"empty-state"},Ve=j({__name:"SearchPage",setup(Ae){const y=q(),L=K(),d=se(),r=h(""),f=h([]),c=h(!1),w=h(null),S=R(()=>{try{return r.value&&r.value.trim().length>0}catch{return!1}}),C=R(()=>{try{return!r.value||!r.value.trim()?[]:d.searchAnimals(r.value)||[]}catch(s){return console.error("æœç´¢å¤±è´¥:",s),[]}}),u=h(["é‡‘æ¯›çŠ¬","æ©˜çŒ«","å“ˆå£«å¥‡","é¸Ÿç±»","é±¼ç±»"]),i=h([]),_=R(()=>{try{if(!r.value||!r.value.trim())return[];const s=r.value.toLowerCase().trim();if(!s)return[];const e=new Set;try{d.animals&&Array.isArray(d.animals)&&d.animals.length>0&&d.animals.forEach(t=>{try{t&&t.name&&typeof t.name=="string"&&t.name.toLowerCase().includes(s)&&e.add(t.name),t&&t.species&&typeof t.species=="string"&&t.species.toLowerCase().includes(s)&&e.add(t.species),t&&t.habitat&&typeof t.habitat=="string"&&t.habitat.toLowerCase().includes(s)&&e.add(t.habitat)}catch{}})}catch(t){console.warn("å¤„ç†åŠ¨ç‰©æ•°æ®æ—¶å‡ºé”™:",t)}try{u.value&&Array.isArray(u.value)&&u.value.length>0&&u.value.forEach(t=>{try{t&&typeof t=="string"&&t.toLowerCase().includes(s)&&e.add(t)}catch{}})}catch(t){console.warn("å¤„ç†çƒ­é—¨æœç´¢æ—¶å‡ºé”™:",t)}return Array.from(e).slice(0,5)}catch(s){return console.error("ç”Ÿæˆæœç´¢å»ºè®®å¤±è´¥:",s),[]}}),H=oe(s=>{s.trim()&&(k.mark("search-start"),z(s),k.measure("search-duration","search-start"))},300),$=re(()=>{D()},1e3),g=s=>{try{s&&s.trim()&&(H(s),c.value=!1)}catch(e){console.error("æœç´¢å¤„ç†å¤±è´¥:",e)}},N=()=>{c.value=!0,V()},E=()=>{c.value=!1,r.value=""},b=s=>{r.value=s,g(s),c.value=!1},T=(s,e)=>{try{if(!s||!e||!e.trim())return s||"";const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=new RegExp(`(${t})`,"gi");return s.replace(l,"<mark>$1</mark>")}catch(t){return console.error("é«˜äº®æ–‡æœ¬å¤±è´¥:",t),s||""}},z=s=>{if(!s.trim())return;const e=i.value.indexOf(s);e>-1&&i.value.splice(e,1),i.value.unshift(s),i.value.length>10&&(i.value=i.value.slice(0,10)),x()},F=s=>{i.value.splice(s,1),x()},O=()=>{confirm("ç¡®å®šè¦æ¸…é™¤æœç´¢å†å²å—ï¼Ÿ")&&(i.value=[],x())},x=()=>{try{localStorage.setItem("animalsnap-search-history",JSON.stringify(i.value))}catch(s){console.error("ä¿å­˜æœç´¢å†å²å¤±è´¥:",s)}},V=()=>{try{const s=localStorage.getItem("animalsnap-search-history");s&&(i.value=JSON.parse(s))}catch(s){console.error("åŠ è½½æœç´¢å†å²å¤±è´¥:",s)}},D=()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½");return}try{const s=window.SpeechRecognition||window.webkitSpeechRecognition,e=new s;e.lang="zh-CN",e.continuous=!1,e.interimResults=!1,e.onstart=()=>{console.log("å¼€å§‹è¯­éŸ³è¯†åˆ«...")},e.onresult=t=>{const l=t.results[0][0].transcript;r.value=l,g(l)},e.onerror=t=>{console.error("è¯­éŸ³è¯†åˆ«é”™è¯¯:",t.error),alert("è¯­éŸ³è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•")},e.onend=()=>{console.log("è¯­éŸ³è¯†åˆ«ç»“æŸ")},e.start()}catch(s){console.error("è¯­éŸ³è¯†åˆ«åˆå§‹åŒ–å¤±è´¥:",s),alert("è¯­éŸ³è¯†åˆ«åŠŸèƒ½ä¸å¯ç”¨")}},I=()=>{$()},J=(s,e)=>{const t=f.value.indexOf(s);e&&t===-1?f.value.push(s):!e&&t>-1&&f.value.splice(t,1)},P=()=>{y.push("/camera")},Q=s=>{y.push(`/animal-detail/${s}`)},U=()=>{y.back()},A=s=>{const e=s.target;!e.closest(".search-header")&&!e.closest(".search-suggestions")&&c.value&&(c.value=!1)};return G(()=>{try{k.mark("search-page-mounted"),d.loadAnimals(),f.value=[],V(),document.addEventListener("click",A);const s=L.query.q;s?(r.value=s,g(s)):setTimeout(()=>{w.value&&w.value.focus()},100),k.measure("search-page-load","search-page-mounted")}catch(s){console.error("é¡µé¢åˆå§‹åŒ–å¤±è´¥:",s)}}),W(()=>{document.removeEventListener("click",A)}),(s,e)=>(a(),n("div",le,[o("div",ce,[o("button",{class:"back-btn",onClick:U},[...e[1]||(e[1]=[o("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[o("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),o("div",ue,[X(ae,{ref_key:"searchBarRef",ref:w,modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),placeholder:"æœç´¢åŠ¨ç‰©ã€æ –æ¯åœ°...",onSearch:g,onVoiceSearch:I,onFocus:N,onClear:E,autofocus:""},null,8,["modelValue"])])]),c.value&&!S.value?(a(),n("div",de,[!r.value.trim()&&u.value&&u.value.length>0?(a(),n("div",he,[e[2]||(e[2]=Y('<div class="section-title" data-v-fc8fbaa2><svg width="16" height="16" viewBox="0 0 24 24" fill="none" data-v-fc8fbaa2><path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2" data-v-fc8fbaa2></path><path d="M2 17l10 5 10-5" stroke="currentColor" stroke-width="2" data-v-fc8fbaa2></path><path d="M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" data-v-fc8fbaa2></path></svg> çƒ­é—¨æœç´¢ </div>',1)),o("div",ve,[(a(!0),n(p,null,m(u.value,(t,l)=>(a(),n("button",{key:l,onClick:B=>b(t),class:"hot-search-tag"},M(t),9,fe))),128))])])):v("",!0),!r.value.trim()&&i.value&&i.value.length>0?(a(),n("div",ge,[o("div",{class:"section-title"},[e[3]||(e[3]=o("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[o("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"}),o("polyline",{points:"12 6 12 12 16 14",stroke:"currentColor","stroke-width":"2"})],-1)),e[4]||(e[4]=Z(" æœç´¢å†å² ",-1)),o("button",{onClick:O,class:"clear-history-btn"},"æ¸…é™¤")]),o("div",pe,[(a(!0),n(p,null,m(i.value,(t,l)=>(a(),n("button",{key:l,onClick:B=>b(t),class:"history-item"},[e[6]||(e[6]=o("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[o("path",{d:"M21 21l-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z",stroke:"currentColor","stroke-width":"2"})],-1)),o("span",null,M(t),1),o("button",{onClick:ee(B=>F(l),["stop"]),class:"remove-history"},[...e[5]||(e[5]=[o("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none"},[o("line",{x1:"18",y1:"6",x2:"6",y2:"18",stroke:"currentColor","stroke-width":"2"}),o("line",{x1:"6",y1:"6",x2:"18",y2:"18",stroke:"currentColor","stroke-width":"2"})],-1)])],8,ke)],8,me))),128))])])):v("",!0),r.value.trim()&&_.value&&_.value.length>0?(a(),n("div",ye,[o("div",we,[(a(!0),n(p,null,m(_.value,(t,l)=>(a(),n("button",{key:l,onClick:B=>b(t),class:"suggestion-item"},[e[7]||(e[7]=o("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[o("path",{d:"M21 21l-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z",stroke:"currentColor","stroke-width":"2"})],-1)),o("span",{innerHTML:T(t,r.value)},null,8,Ce)],8,Se))),128))])])):v("",!0)])):v("",!0),S.value&&r.value.trim()?(a(),n("div",_e,[o("div",be,[e[8]||(e[8]=o("h2",null,"æœç´¢ç»“æœ",-1)),o("span",xe,M(C.value.length)+" ä¸ªç»“æœ",1)]),C.value.length>0?(a(),n("div",Be,[(a(!0),n(p,null,m(C.value,t=>(a(),te(ne,{key:t.id,id:t.id,name:t.name,"image-url":t.image,species:t.species,confidence:t.confidence,date:t.date,"is-favorite":f.value.includes(t.id),size:"small",onClick:Q,onFavorite:J},null,8,["id","name","image-url","species","confidence","date","is-favorite"]))),128))])):(a(),n("div",Re,[e[9]||(e[9]=o("div",{class:"empty-icon"},"ğŸ”",-1)),e[10]||(e[10]=o("h3",null,"æœªæ‰¾åˆ°ç›¸å…³åŠ¨ç‰©",-1)),e[11]||(e[11]=o("p",null,"è¯•è¯•å…¶ä»–å…³é”®è¯æˆ–ä½¿ç”¨æ‹ç…§è¯†åˆ«åŠŸèƒ½",-1)),o("button",{class:"btn-primary",onClick:P},"å¼€å§‹æ‹ç…§è¯†åˆ«")]))])):v("",!0),!S.value&&!c.value?(a(),n("div",Me,[...e[12]||(e[12]=[o("div",{class:"empty-icon"},"ğŸ”",-1),o("h3",null,"å¼€å§‹æœç´¢",-1),o("p",null,"æœç´¢åŠ¨ç‰©ã€æ –æ¯åœ°æˆ–ä½¿ç”¨è¯­éŸ³æœç´¢",-1)])])):v("",!0)]))}}),ze=ie(Ve,[["__scopeId","data-v-fc8fbaa2"]]);export{ze as default};
