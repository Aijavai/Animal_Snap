import{f as I,r as l,d as S,o as A,q as w,s as e,t as P,D as v,I as U,y as j,z as y}from"./vue-vendor-DjNuForC.js";import{u as H}from"./animal-CiS26lDf.js";import{_ as T}from"./index-B5beYMX8.js";import"./vant-vendor-D-yQvc_G.js";const V={class:"camera-page"},z={class:"camera-container"},F={class:"camera-controls"},L=["disabled"],N=["disabled"],O={class:"result-body"},q={class:"animal-info"},G=["src"],W={class:"animal-details"},J={class:"confidence"},K={class:"description"},Q=I({__name:"CameraPage",setup(X){const p=j(),_=H(),n=l(),b=l(),r=l(!1),u=l(!1),c=l(""),o=l({name:"",confidence:0,description:""});let s=null,m="environment";const h=async()=>{try{const a={video:{facingMode:m,width:{ideal:1280},height:{ideal:720}}};s=await navigator.mediaDevices.getUserMedia(a),n.value&&(n.value.srcObject=s,n.value.onloadedmetadata=()=>{r.value=!0})}catch(a){console.error("无法访问相机:",a),alert("无法访问相机，请检查权限设置")}},C=async()=>{s&&s.getTracks().forEach(a=>a.stop()),m=m==="environment"?"user":"environment",await h()},x=()=>{if(!n.value||!r.value)return;const a=document.createElement("canvas"),t=a.getContext("2d");if(!t)return;a.width=n.value.videoWidth,a.height=n.value.videoHeight,t.drawImage(n.value,0,0);const i=a.toDataURL("image/jpeg");c.value=i,f()},f=a=>{setTimeout(()=>{const t=[{name:"金毛犬",confidence:.95,description:"金毛犬是一种大型犬，性格温顺，是优秀的家庭伴侣犬。"},{name:"橘猫",confidence:.88,description:"橘猫是常见的家猫品种，性格活泼，容易亲近人类。"},{name:"哈士奇",confidence:.92,description:"哈士奇是雪橇犬的一种，精力充沛，需要大量运动。"}],i=t[Math.floor(Math.random()*t.length)];i&&(o.value=i,u.value=!0)},2e3)},M=()=>{const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=t=>{const i=t.target.files?.[0];if(i){const k=new FileReader;k.onload=E=>{const B=E.target?.result;c.value=B,f()},k.readAsDataURL(i)}},a.click()},d=()=>{u.value=!1},D=()=>{const a={id:Date.now().toString(),name:o.value.name,image:c.value,confidence:o.value.confidence,description:o.value.description,species:"宠物",habitat:"家庭",date:new Date().toISOString()};_.addAnimal(a),d(),p.push("/")},g=()=>{s&&(s.getTracks().forEach(a=>a.stop()),s=null)},R=()=>{g(),p.push("/")};return S(()=>{h()}),A(()=>{g()}),(a,t)=>(y(),w("div",V,[e("div",z,[e("button",{class:"exit-btn",onClick:R},[...t[1]||(t[1]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),e("div",{class:"camera-preview",ref_key:"cameraPreview",ref:b},[e("video",{ref_key:"videoElement",ref:n,autoplay:"",muted:"",playsinline:""},null,512),t[2]||(t[2]=e("div",{class:"camera-overlay"},[e("div",{class:"focus-frame"}),e("div",{class:"camera-tips"},[e("p",null,"将动物放在框内，点击拍照识别")])],-1))],512),e("div",F,[e("button",{class:"control-btn gallery-btn",onClick:M},[...t[3]||(t[3]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2",stroke:"currentColor","stroke-width":"2"}),e("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor"}),e("polyline",{points:"21,15 16,10 5,21",stroke:"currentColor","stroke-width":"2"})],-1)])]),e("button",{class:"capture-btn",onClick:x,disabled:!r.value},[...t[4]||(t[4]=[e("div",{class:"capture-inner"},null,-1)])],8,L),e("button",{class:"control-btn switch-camera-btn",onClick:C,disabled:!r.value},[...t[5]||(t[5]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z",stroke:"currentColor","stroke-width":"2"}),e("line",{x1:"12",y1:"17",x2:"12",y2:"17",stroke:"currentColor","stroke-width":"2"})],-1)])],8,N)])]),u.value?(y(),w("div",{key:0,class:"result-modal",onClick:d},[e("div",{class:"result-content",onClick:t[0]||(t[0]=U(()=>{},["stop"]))},[e("div",{class:"result-header"},[t[6]||(t[6]=e("h3",null,"识别结果",-1)),e("button",{class:"close-btn",onClick:d},"×")]),e("div",O,[e("div",q,[e("img",{src:c.value,alt:"识别结果",class:"result-image"},null,8,G),e("div",W,[e("h4",null,v(o.value.name),1),e("p",J,"置信度: "+v(Math.round(o.value.confidence*100))+"%",1),e("p",K,v(o.value.description),1)])]),e("div",{class:"result-actions"},[e("button",{class:"btn-secondary",onClick:d},"重新拍照"),e("button",{class:"btn-primary",onClick:D},"保存到我的动物")])])])])):P("",!0)]))}}),te=T(Q,[["__scopeId","data-v-5a74507d"]]);export{te as default};
